=================
nethserver-alerts
=================

This package monitors the machine using collectd and route notifications to a remote server.

Collectd listens for notification on a well known socket: ``/var/run/collectd.sock``.

Notifications can be generated by collectd thresholds, cron jobs or even external daemons like *NMS*.

Collectd thresholds
===================

You can trigger an alarm named ``testalarm`` from command line: ::

  echo -e "PUTNOTIF host=$(hostname) type=custom type_instance=testalarm severity=failure time=$(date +%s) message=\"$1 FAILURE\"" | nc -U /var/run/collectd.sock &>/dev/null

You can also resolve the above alarm: ::

  echo -e "PUTNOTIF host=$(hostname) type=custom type_instance=testalarm severity=okay time=$(date +%s) message=\"$1 OK\"" | nc -U /var/run/collectd.sock &>/dev/null


Adding a threshold configuration
--------------------------------

Create a ``/etc/collectd.d/threshold.conf`` template fragment using collectd threshold syntax. Enjoy collectd docs here https://collectd.org/documentation/manpages/collectd-threshold.5.shtml


NethServer Monitor Services (NMS)
=================================

NMS is a python daemon which monitor the status of all services registered inside the configuration db.
Each service is check every 300 seconds, if the status of service changes, NMS writes a notification to collectd socket.

Configuration
=============

NethServer Enterprise subscrptions
----------------------------------

URL: https://my.nethserver.com/api/

To configure execute: ::

  config setprop subscription AlertsUrl https://my.nethserver.com/api/
  signal-event nethserver-alerts-update

Nethesis Enterprise subscriptions
---------------------------------

URL: https://my.nethesis.it/isa


To configure execute: ::

  config setprop subscription AlertsUrl https://my.nethesis.it/isa
  signal-event nethserver-alerts-update

